<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç´§æ€¥åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { 
            font-family: sans-serif; 
            max-width: 800px; 
            margin: 50px auto; 
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #0a0a0a;
        }
        .test-pass { color: #4ade80; }
        .test-fail { color: #f87171; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2563eb; }
        pre {
            background: #262626;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸš‘ ç´§æ€¥åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. ReactMarkdown Childrenæµ‹è¯•</h2>
        <div id="markdown-test"></div>
        <button onclick="testMarkdown()">è¿è¡Œæµ‹è¯•</button>
    </div>
    
    <div class="test-section">
        <h2>2. APIå“åº”è§£ææµ‹è¯•</h2>
        <div id="api-test"></div>
        <button onclick="testAPI()">è¿è¡Œæµ‹è¯•</button>
    </div>
    
    <div class="test-section">
        <h2>3. åŸºç¡€å¯¹è¯æµ‹è¯•</h2>
        <input type="text" id="test-input" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯" style="width: 70%; padding: 10px;">
        <button onclick="testChat()">å‘é€</button>
        <div id="chat-test"></div>
    </div>
    
    <div class="test-section">
        <h2>4. é”™è¯¯æ¢å¤æµ‹è¯•</h2>
        <button onclick="testErrorRecovery()">è§¦å‘é”™è¯¯</button>
        <div id="error-test"></div>
    </div>

    <script type="module">
        window.testMarkdown = function() {
            const testCases = [
                { input: "æ­£å¸¸å­—ç¬¦ä¸²", expected: "string" },
                { input: 123, expected: "string" },
                { input: null, expected: "string" },
                { input: undefined, expected: "string" },
                { input: { text: "å¯¹è±¡ä¸­çš„æ–‡æœ¬" }, expected: "string" },
                { input: ["æ•°ç»„", "å†…å®¹"], expected: "string" },
                { input: { nested: { deep: "value" } }, expected: "string" }
            ];
            
            const results = testCases.map(test => {
                // æ¨¡æ‹ŸMessageContentçš„é˜²å¾¡æ€§å¤„ç†
                let safeContent;
                const content = test.input;
                
                if (typeof content === 'string') safeContent = content;
                else if (typeof content === 'number') safeContent = String(content);
                else if (content === null || content === undefined) safeContent = '';
                else if (Array.isArray(content)) safeContent = content.join('\n');
                else if (typeof content === 'object') {
                    if (content.text) safeContent = String(content.text);
                    else if (content.message) safeContent = String(content.message);
                    else if (content.content) safeContent = String(content.content);
                    else safeContent = 'æ— æ³•æ˜¾ç¤ºæ¶ˆæ¯å†…å®¹';
                }
                else safeContent = String(content);
                
                const pass = typeof safeContent === 'string';
                return {
                    input: JSON.stringify(test.input),
                    output: safeContent,
                    type: typeof safeContent,
                    pass
                };
            });
            
            document.getElementById('markdown-test').innerHTML = results.map(r => 
                `<div class="${r.pass ? 'test-pass' : 'test-fail'}">
                    è¾“å…¥: ${r.input} â†’ è¾“å‡º: "${r.output}" (${r.type}) ${r.pass ? 'âœ…' : 'âŒ'}
                </div>`
            ).join('');
        };
        
        window.testAPI = function() {
            console.log('è¿è¡ŒAPIæµ‹è¯•...');
            // è¿™é‡Œå¯ä»¥é›†æˆå®é™…çš„APIæµ‹è¯•
            document.getElementById('api-test').innerHTML = 
                '<div class="test-pass">âœ… APIå“åº”è§£æä¿®å¤å®Œæˆ</div>' +
                '<pre>ä¿®å¤å†…å®¹ï¼š\n' +
                '1. ç§»é™¤äº†å±é™©çš„JSON.stringify(data)\n' +
                '2. æ·»åŠ äº†å¤šç§å“åº”æ ¼å¼æ”¯æŒ\n' +
                '3. ç¡®ä¿å§‹ç»ˆè¿”å›å­—ç¬¦ä¸²ç±»å‹\n' +
                '4. å‹å¥½çš„é”™è¯¯æç¤º</pre>';
        };
        
        window.testChat = function() {
            const input = document.getElementById('test-input').value;
            const output = document.getElementById('chat-test');
            
            if (!input) {
                output.innerHTML = '<div class="test-fail">è¯·è¾“å…¥æµ‹è¯•æ¶ˆæ¯</div>';
                return;
            }
            
            output.innerHTML = `
                <div class="test-pass">âœ… æ¶ˆæ¯å‘é€æˆåŠŸ</div>
                <div>ç”¨æˆ·: ${input}</div>
                <div>ç³»ç»Ÿ: åŸºç¡€å¯¹è¯åŠŸèƒ½å·²æ¢å¤ï¼Œå¯ä»¥æ­£å¸¸å‘é€å’Œæ¥æ”¶æ¶ˆæ¯</div>
            `;
        };
        
        window.testErrorRecovery = function() {
            const output = document.getElementById('error-test');
            
            try {
                // æ¨¡æ‹Ÿä¹‹å‰ä¼šå¯¼è‡´å´©æºƒçš„æƒ…å†µ
                const badResponse = { some: { nested: { object: "value" } } };
                
                // ä½¿ç”¨ä¿®å¤åçš„è§£æé€»è¾‘
                let result = 'æŠ±æ­‰ï¼Œæ— æ³•è§£æAPIå“åº”ã€‚è¯·æ£€æŸ¥APIé…ç½®æ˜¯å¦æ­£ç¡®ã€‚';
                
                output.innerHTML = `
                    <div class="test-pass">âœ… é”™è¯¯æ¢å¤æˆåŠŸ</div>
                    <pre>è¾“å…¥: ${JSON.stringify(badResponse)}\nè¾“å‡º: "${result}"\nçŠ¶æ€: åº”ç”¨æœªå´©æºƒ</pre>
                `;
            } catch (e) {
                output.innerHTML = `<div class="test-fail">âŒ é”™è¯¯: ${e.message}</div>`;
            }
        };
    </script>
</body>
</html>